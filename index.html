
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>ENRULATOR - Simulador de Rulos Cambiarios</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f7f7f7; padding: 20px; color: #222; }
    h1, h2 { color: #333; text-align: center; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 30px; background: white; }
    th, td { padding: 10px; border: 1px solid #ccc; text-align: center; }
    th { background: #4CAF50; color: white; }
    input, select, button { padding: 8px; font-size: 1em; margin: 5px; }
    .green { color: green; }
    .red { color: red; }
    .yellow { color: goldenrod; }
    .banner { text-align: center; margin-bottom: 30px; }
    .banner img { max-width: 100%; border-radius: 10px; box-shadow: 0 0 20px rgba(0,0,0,0.3); }
  </style>
</head>
<body>
  <h1>ENRULATOR</h1>
  <div class="banner">
    <img src="enrulator.png" alt="ENRULATOR" />
  </div>

  <div id="error" style="color: red; text-align:center;"></div>

  <h2>Cotizaciones</h2>
  <table id="cotizaciones">
    <thead><tr><th>Tipo</th><th>Valor</th></tr></thead>
    <tbody></tbody>
  </table>

  <h2>Desarbitrajes</h2>
  <table id="spreads">
    <thead><tr><th>Relación</th><th>Spread</th><th>Ganancia por u$s1000</th></tr></thead>
    <tbody></tbody>
  </table>

  <h2>Simulador de Rulo</h2>
  <label>Monto en USD: <input type="number" id="monto" value="1000" /></label>
  <label>Repeticiones: <input type="number" id="vueltas" value="1" /></label>
  <label>Rulo:
    <select id="rulo">
      <option value="blue_vs_oficial">Oficial → Blue</option>
      <option value="mep_vs_oficial">Oficial → MEP</option>
      <option value="ccl_vs_mep">MEP → CCL</option>
      <option value="cripto_vs_blue">Cripto → Blue</option>
    </select>
  </label>
  <button onclick="simular()">Simular</button>

  <div id="resultado" style="margin-top: 15px; font-weight: bold;"></div>

  <script>
    let cotizaciones = {};
    let spreads = {};

    async function fetchData() {
      try {
        const res = await fetch("https://spreads-dolar-argentina.onrender.com");
        const data = await res.json();

        cotizaciones = data.cotizaciones || {};
        spreads = data.desarbitrajes || {};
        const errores = data.errores || {};

        const cotBody = document.querySelector("#cotizaciones tbody");
        const sprBody = document.querySelector("#spreads tbody");

        cotBody.innerHTML = "";
        for (const key in {oficial:'', blue:'', mep:'', ccl:'', cripto:''}) {
          const valor = cotizaciones[key];
          cotBody.innerHTML += `<tr><td>${key.toUpperCase()}</td><td>${valor ?? "Sin datos"}</td></tr>`;
        }

        sprBody.innerHTML = "";
        const combinaciones = {
          blue_vs_oficial: ["blue", "oficial"],
          mep_vs_oficial: ["mep", "oficial"],
          ccl_vs_mep: ["ccl", "mep"],
          cripto_vs_blue: ["cripto", "blue"]
        };

        for (const key in combinaciones) {
          const [venta, compra] = combinaciones[key];
          const spread = spreads[key] ?? "No disponible";
          const ganancia = (cotizaciones[venta] && cotizaciones[compra]) ?
            `$${((cotizaciones[venta] - cotizaciones[compra]) * 1000).toFixed(2)}` : "—";
          let clase = "";
          const num = parseFloat(spread);
          if (!isNaN(num)) clase = num > 10 ? "green" : num > 1 ? "yellow" : "red";
          sprBody.innerHTML += `<tr><td>${key.replace(/_/g, ' ').toUpperCase()}</td><td class="${clase}">${spread}</td><td>${ganancia}</td></tr>`;
        }

        if (Object.keys(errores).length > 0) {
          document.getElementById("error").textContent = "Algunas fuentes no respondieron correctamente.";
        }
      } catch (e) {
        document.getElementById("error").textContent = "Error al conectar con el backend.";
      }
    }

    function simular() {
      const monto = parseFloat(document.getElementById("monto").value);
      const vueltas = parseInt(document.getElementById("vueltas").value);
      const rulo = document.getElementById("rulo").value;

      const map = {
        blue_vs_oficial: ["blue", "oficial"],
        mep_vs_oficial: ["mep", "oficial"],
        ccl_vs_mep: ["ccl", "mep"],
        cripto_vs_blue: ["cripto", "blue"]
      };

      const [venta, compra] = map[rulo] || [];

      if (!(cotizaciones[venta] && cotizaciones[compra])) {
        document.getElementById("resultado").textContent = "No hay datos suficientes para simular ese rulo.";
        return;
      }

      const ganancia = (cotizaciones[venta] - cotizaciones[compra]) * monto * vueltas;
      document.getElementById("resultado").textContent = 
        `Si hacés ${vueltas} vez/veces el rulo ${venta.toUpperCase()} → ${compra.toUpperCase()} con u$s${monto}, ganás $${ganancia.toFixed(2)} ARS.`;
    }

    fetchData();
    setInterval(fetchData, 60000);
  </script>
</body>
</html>
